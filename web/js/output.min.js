function get_commands(){return new Map([["transform",command_transform_element],["add",command_add_element],["delete",command_delete_element],["update",command_update_element]])}function send_command_transform_element(t,e){t.send({type:"transform",args:{id:e.id(),transform:e.data.transform},session:t.session_id})}function command_transform_element(t,e){var i=t.elements.get(e.id);null!=i&&(i.data.transform=e.transform,i.update(),t.is_editor()&&t.update_selected_element())}function send_command_add_element(t,e){t.send({type:"add",args:e.data,session:t.session_id})}function command_add_element(t,e){let i=create_element(t,e.type,e);null!=i&&(t.elements.set(i.id(),i),t.container.appendChild(i.html),i.update(),t.is_editor()&&t.on_element_added(i))}function send_command_delete_element(t,e){t.send({type:"delete",args:{id:e},session:t.session_id})}function command_delete_element(t,e){t.elements.get(e.id).delete(),t.elements.delete(e.id)}function send_command_update_element(t,e){t.send({type:"update",args:e.data,session:t.session_id})}function command_update_element(t,e){let i=t.elements.get(e.id);null!=i&&(i.data=e,i.update(),t.is_editor()&&t.update_selected_element())}class viewer{constructor(t){this.container=t,this.elements=new Map,this.tickable_elements=[],this.commands=get_commands(),this.connected=!1,this.socket=new WebSocket(config.WEBSOCKET_URL),this.socket.onopen=t=>this.on_open(t),this.socket.onmessage=t=>this.on_data(t),this.socket.onclose=t=>this.on_close(t),this.socket.onerror=t=>this.on_error(t),$(window).on("resize",(()=>this.on_resize())),this.on_resize();let e=new URL(window.location.href);this.session_id=e.searchParams.get("session"),this.session_id||alert("No session id provided!")}get_canvas_width(){return this.container.clientWidth}get_canvas_height(){return this.container.clientHeight}on_resize(){this.container.width=window.innerWidth,this.container.height=window.innerHeight}tick(){tickable_elements.forEach((t=>t.tick()))}on_error(t){console.log(t),this.connected=!1}on_close(t){this.connected=!1,setTimeout((()=>{this.socket=new WebSocket(config.WEBSOCKET_URL),this.socket.onopen=t=>this.on_open(t),this.socket.onmessage=t=>this.on_data(t),this.socket.onclose=t=>this.on_close(t),this.socket.onerror=t=>this.on_error(t)}),1e3)}on_open(t){this.connected=!0,this.socket.send(JSON.stringify({session:this.session_id}))}on_data(t){let e=JSON.parse(t.data);if(void 0===e.type)for(const[t,i]of Object.entries(e))command_add_element(this,i);else this.parse_and_run_command(e,this)}parse_and_run_command(t){this.commands.has(t.type)&&this.commands.get(t.type)(this,t.args)}send(t){this.connected&&this.socket.send(JSON.stringify(t))}is_editor(){return!1}}const config={WEBSOCKET_URL:"ws://localhost:8080/ws",ROOT:"/",IS_CHROME:-1!==navigator.userAgent.indexOf("Chrome")};class editor extends viewer{constructor(t){super(t),this.player_container=$("#player-container"),this.main_container=$("#main-container"),this.in_landscape_mode=!1,this.internal_clipboard=null,this.selected_element=null,this.dragging_element=!1,this.current_mode=EDIT_MODE.NONE,this.mode_axis=MODE_AXIS.NONE,this.initial_position={x:-1,y:-1},this.initial_element_size={width:0,height:0},this.start_rotation_angle=0,this.element_handlers=[new text_element_handler(this),new image_element_handler(this)],this.pos_x=$("#pos-x"),this.pos_y=$("#pos-y"),this.width=$("#width"),this.height=$("#height"),this.z_index=$("#z-index"),this.opacity=$("#opacity"),this.visibility=$("#visibility"),this.element_name=$("#element-name"),this.element_list=$("#element-list-select"),this.canvas_width=$("#canvas-width"),this.canvas_height=$("#canvas-height"),this.editor_canvas=$("#editor-canvas"),this.ctx=this.editor_canvas.getContext("2d"),this.mouse_pos=[0,0],this.element_count=0;let e=document.getElementsByClassName("pivot-option");this.pivot_options=[];for(let t=0;t<e.length;t++)this.pivot_options.push(e[t]),$(e[t]).on("click",(()=>{this.on_pivot_changed(e[t])}));$(this.editor_canvas).on("mousemove",(t=>this.on_mouse_move(t))),$(this.editor_canvas).on("mouseup",(t=>this.on_mouse_up(t))),$(this.container).on("mousedown",(t=>this.on_mouse_down(t))),$(document).on("keydown",(t=>this.on_key_down(t))),$(document).on("keyup",(t=>this.on_key_up(t))),$(this.element_name).on("input",(()=>this.on_element_name_changed())),$(this.canvas_width).on("change",(()=>this.on_resize())),$(this.canvas_height).on("change",(()=>this.on_resize())),$(this.opacity).on("change",(()=>this.on_opacity_changed())),$(this.z_index).on("change",(()=>this.on_z_index_changed())),$(this.visibility).on("change",(()=>this.on_visibility_changed())),$(this.element_list).on("change",(()=>{this.on_element_clicked(null,this.elements.get(this.element_list.value))})),this.canvas_width.value="1920",this.canvas_height.value="1080",load_settings(),this.on_resize(),requestAnimationFrame((()=>this.draw()))}draw_mode_overlay(){this.mode_axis!=MODE_AXIS.X&&this.mode_axis!=MODE_AXIS.XY||(this.ctx.beginPath(),this.ctx.moveTo(0,this.selected_element.tf().y+this.selected_element.tf().height/2),this.ctx.lineTo(this.editor_canvas.width,this.selected_element.tf().y+this.selected_element.tf().height/2),this.ctx.strokeStyle="red",this.ctx.stroke()),this.mode_axis!=MODE_AXIS.Y&&this.mode_axis!=MODE_AXIS.XY||(this.ctx.beginPath(),this.ctx.moveTo(this.selected_element.tf().x+this.selected_element.tf().width/2,0),this.ctx.lineTo(this.selected_element.tf().x+this.selected_element.tf().width/2,this.editor_canvas.height),this.ctx.strokeStyle="green",this.ctx.stroke())}handle_edit_modes(t){if(this.current_mode==EDIT_MODE.SCALE){let t=this.initial_position.x-this.selected_element.tf().x,e=this.initial_position.y-this.selected_element.tf().x,i=Math.sqrt(t*t+e*e);t=this.mouse_pos[0]-this.selected_element.tf().x,e=this.mouse_pos[1]-this.selected_element.tf().y;let s=Math.sqrt(t*t+e*e)/i;switch(this.mode_axis){case MODE_AXIS.X:this.selected_element.tf().scale_x=this.initial_element_size.x*s;break;case MODE_AXIS.Y:this.selected_element.tf().scale_y=this.initial_element_size.y*s;break;case MODE_AXIS.XY:this.selected_element.tf().scale_x=this.initial_element_size.x*s,this.selected_element.tf().scale_y=this.initial_element_size.y*s}this.selected_element.update(),send_command_transform_element(this,this.selected_element),this.update_selected_element()}else if(this.current_mode==EDIT_MODE.MOVE){let t=this.mouse_pos[0]-this.initial_position.x,e=this.mouse_pos[1]-this.initial_position.y;switch(this.mode_axis){case MODE_AXIS.X:this.selected_element.tf().x=Math.round(this.initial_element_size.x+t);break;case MODE_AXIS.Y:this.selected_element.tf().y=Math.round(this.initial_element_size.y+e);break;case MODE_AXIS.XY:this.selected_element.tf().x=Math.round(this.initial_element_size.x+t),this.selected_element.tf().y=Math.round(this.initial_element_size.y+e)}send_command_transform_element(this,this.selected_element),this.selected_element.update(),this.update_selected_element()}else if(this.current_mode==EDIT_MODE.ROTATE){let t=this.initial_position.x-(this.selected_element.tf().x+this.selected_element.tf().width/2),e=this.initial_position.y-(this.selected_element.tf().y+this.selected_element.tf().height/2),i=this.mouse_pos[0]-(this.selected_element.tf().x+this.selected_element.tf().width/2),s=this.mouse_pos[1]-(this.selected_element.tf().y+this.selected_element.tf().height/2),n=Math.atan2(s,i)-Math.atan2(e,t),h=Math.round(this.initial_element_size.rotation+180*n/Math.PI);switch(this.mode_axis){case MODE_AXIS.X:this.selected_element.tf().rotation_x=h;break;case MODE_AXIS.Y:this.selected_element.tf().rotation_y=h;break;case MODE_AXIS.Z:this.selected_element.tf().rotation_z=h}this.selected_element.update(),send_command_transform_element(this,this.selected_element),this.update_selected_element()}}draw(){this.ctx.clearRect(0,0,this.editor_canvas.width,this.editor_canvas.height),this.selected_element&&this.draw_mode_overlay(),requestAnimationFrame((()=>this.draw()))}on_element_clicked(t,e){this.select_element(e),e.html.classList.add("selected-element")}on_key_up(t){if("Space"==t.code)for(let[t,e]of this.elements)e.html.classList.remove("highlighted-element")}on_key_down(t){if(!$("#settings-window").contains(t.target)){if("Space"==t.code)for(let[t,e]of this.elements)e.html.classList.add("highlighted-element");for(let e of editor_keybinds)t.code==e.code&&!e.ctrl^t.ctrlKey&&!e.shift^t.shiftKey&&e.function(this,t)}}on_resize(){this.main_container&&(this.container.style.width=this.canvas_width.value+"px",this.container.style.height=this.canvas_height.value+"px",this.editor_canvas.width=this.canvas_width.value,this.editor_canvas.height=this.canvas_height.value,this.main_container.clientWidth/this.main_container.clientHeight>1?(this.player_container.classList.remove("portrait-player"),this.player_container.classList.add("landscape-player"),this.in_landscape_mode=!0):(this.player_container.classList.remove("landscape-player"),this.player_container.classList.add("portrait-player"),this.in_landscape_mode=!1),this.in_landscape_mode?this.scale_factor=this.player_container.clientWidth/this.container.clientWidth:this.scale_factor=this.player_container.clientHeight/this.container.clientHeight,this.container.style.transform=`scale(${this.scale_factor})`,this.editor_canvas.style.transform=`scale(${this.scale_factor})`,save_settings())}on_mouse_down(t){t.target===this.container&&(this.current_mode===EDIT_MODE.NONE&&this.select_element(null),this.leave_mode())}on_mouse_up(t){this.leave_mode()}on_mouse_move(t){this.mouse_pos=[this.chrome_scale_fuckery(t.layerX),this.chrome_scale_fuckery(t.layerY)],-1==this.initial_position.x&&(this.initial_position.x=this.mouse_pos[0],this.initial_position.y=this.mouse_pos[1]),this.handle_edit_modes(t)}on_element_added(t){$(t.html).on("click",(e=>this.on_element_clicked(e,t))),this.element_count++,this.rebuild_element_list()}on_opacity_changed(){this.selected_element&&(this.selected_element.tf().opacity=this.opacity.value/100,this.selected_element.update(),send_command_transform_element(this,this.selected_element))}on_z_index_changed(){this.selected_element&&(this.selected_element.tf().z_index=Number(this.z_index.value),this.selected_element.update(),send_command_transform_element(this,this.selected_element),this.rebuild_element_list())}on_visibility_changed(){this.selected_element&&(this.selected_element.tf().visible=this.visibility.checked,this.selected_element.update(),send_command_transform_element(this,this.selected_element))}on_pivot_changed(t){this.selected_element&&(this.pivot_options.forEach((t=>t.classList.remove("selected"))),t.classList.add("selected"),t.classList.contains("horizontal")?this.selected_element.tf().h_pivot=t.getAttribute("pivot"):this.selected_element.tf().v_pivot=t.getAttribute("pivot"),this.selected_element.update(),this.update_selected_element(),send_command_transform_element(this,this.selected_element))}on_element_name_changed(){this.selected_element&&(this.selected_element.data.name=this.element_name.value,send_command_update_element(this,this.selected_element),this.rebuild_element_list())}rebuild_element_list(){this.element_list.innerHTML="";let t=[];for(let[e,i]of this.elements)t.push(i);t.reverse(),t.sort(((t,e)=>e.tf().z_index-t.tf().z_index)),t.forEach((t=>{let e=document.createElement("option");e.value=t.id(),e.innerHTML=t.data.name,this.element_list.appendChild(e)})),this.element_list.value=this.selected_element?this.selected_element.id():""}add_element(t){this.elements.set(t.id(),t),send_command_add_element(this,t),this.container.appendChild(t.html),t.update(),this.on_element_added(t),this.select_element(t),t.html.classList.add("selected-element")}select_element(t){if(this.selected_element===t)return;this.selected_element&&this.selected_element.html.classList.remove("selected-element"),this.element_list.value=t?t.id():"",this.selected_element=t,this.element_handlers.forEach((t=>t.hide_settings())),t&&(this.update_selected_element(),this.element_handlers.find((e=>e.type==t.type())).show_settings(t));let e=document.getElementsByClassName("window");for(let i=0;i<e.length;i++)t?e[i].classList.remove("inactive"):e[i].classList.add("inactive")}update_selected_element(){null!=this.selected_element&&(this.element_handlers.find((t=>t.type==this.selected_element.type())).show_settings(this.selected_element),this.pos_x.value=this.selected_element.tf().x,this.pos_y.value=this.selected_element.tf().y,this.width.value=this.selected_element.tf().width,this.height.value=this.selected_element.tf().height,this.z_index.value=Number(this.selected_element.tf().z_index),this.opacity.value=100*this.selected_element.tf().opacity,this.visibility.checked=this.selected_element.tf().visible,this.element_name.value=this.selected_element.data.name,this.pivot_options.forEach((t=>t.classList.remove("selected"))),$(`#pivot-h-${this.selected_element.tf().h_pivot}`).classList.add("selected"),$(`#pivot-v-${this.selected_element.tf().v_pivot}`).classList.add("selected"))}is_editor(){return!0}chrome_scale_fuckery(t){return config.IS_CHROME?t/this.scale_factor:t}enter_mode(t,e=MODE_AXIS.XY){this.current_mode=t,this.mode_axis=e,this.editor_canvas.classList.remove("no-input")}leave_mode(){this.current_mode=EDIT_MODE.NONE,this.mode_axis=MODE_AXIS.NONE,this.editor_canvas.classList.add("no-input"),this.initial_position.x=-1,this.initial_position.y=-1}get_next_element_id(){return this.element_count+1}}var edt=null;function keybind_copy(t,e){t.selected_element&&(t.internal_clipboard=t.selected_element)}function keybind_paste(t,e){read_data_from_clipboard().then((e=>{0===e.indexOf("data:image")||/https?:\/\/.*\.(jpg|png|gif|jpeg|apng|webp|jxl|bmp)/gi.test(e)?t.add_element(new image_element(t,{url:e})):t.add_element(new text_element(t,{text:e,size:32,font:"Arial",color:"#000000"}))}))}function keybind_paste_internal(t,e){if(t.internal_clipboard){let e=t.internal_clipboard.clone();e.tf().x+=10,e.tf().y+=10,t.add_element(e)}}function keybind_delete_selected_element(t,e){t.selected_element&&(t.selected_element.html.remove(),t.elements.delete(t.selected_element.id()),send_command_delete_element(t,t.selected_element.id()),t.select_element(null))}function keybind_toggle_overlay(t,e){t.overlay.classList.toggle("hide-overlay")}function keybind_mirror_selected_element(t,e){t.selected_element&&(e.shiftKey?t.selected_element.flip_y():t.selected_element.flip_x(),send_command_update_element(t,t.selected_element))}function keybind_enter_scale_mode(t,e){t.selected_element&&(t.enter_mode(EDIT_MODE.SCALE,MODE_AXIS.XY),t.initial_element_size={x:t.selected_element.tf().scale_x,y:t.selected_element.tf().scale_y})}function keybind_enter_move_mode(t,e){t.selected_element&&(t.enter_mode(EDIT_MODE.MOVE,MODE_AXIS.XY),t.initial_element_size={x:t.selected_element.tf().x,y:t.selected_element.tf().y})}function keybind_enter_rotate_mode(t,e){t.selected_element&&(t.enter_mode(EDIT_MODE.ROTATE,MODE_AXIS.Z),t.initial_element_size={rotation:t.selected_element.tf().rotation_z})}function keybind_exit_editor_modes(t,e){t.selected_element&&t.leave_mode()}function keybind_switch_axis_x(t,e){t.mode_axis!==MODE_AXIS.NONE&&(t.mode_axis=MODE_AXIS.X)}function keybind_switch_axis_y(t,e){t.mode_axis!==MODE_AXIS.NONE&&(t.mode_axis=MODE_AXIS.Y)}function keybind_switch_axis_xy(t,e){t.mode_axis!==MODE_AXIS.NONE&&(t.mode_axis=MODE_AXIS.XY)}function keybind_reset_transform(t,e){t.selected_element&&(t.selected_element.reset_transform(),t.update_selected_element(),send_command_update_element(t,t.selected_element),e.preventDefault())}$(document).ready((()=>edt=new editor($("#overlay"))));const editor_keybinds=[{code:"KeyC",ctrl:!0,function:keybind_copy},{code:"KeyC",shift:!0,function:keybind_copy},{code:"KeyV",ctrl:!0,function:keybind_paste},{code:"KeyV",shift:!0,function:keybind_paste_internal},{code:"Delete",ctrl:!1,function:keybind_delete_selected_element},{code:"KeyE",ctrl:!0,function:keybind_toggle_overlay},{code:"KeyM",ctrl:!1,function:keybind_mirror_selected_element},{code:"KeyS",ctrl:!1,function:keybind_enter_scale_mode},{code:"KeyG",ctrl:!1,function:keybind_enter_move_mode},{code:"KeyR",ctrl:!1,function:keybind_enter_rotate_mode},{code:"Escape",ctrl:!1,function:keybind_exit_editor_modes},{code:"KeyX",ctrl:!1,function:keybind_switch_axis_x},{code:"KeyY",ctrl:!1,function:keybind_switch_axis_y},{code:"KeyZ",shift:!0,function:keybind_switch_axis_xy},{code:"KeyR",ctrl:!0,function:keybind_reset_transform}];var moving_window=null,move_offset=[];$(document).ready((()=>{["#settings","#element-list"].forEach((t=>{$(`${t}-header`).on("mousedown",(e=>{moving_window=$(`${t}-window`),move_offset=[e.clientX-moving_window.offsetLeft,e.clientY-moving_window.offsetTop]}))})),$(document).on("mouseup",(()=>{moving_window=null,save_settings()})),$(document).on("mousemove",(t=>{moving_window&&(moving_window.style.left=t.clientX-move_offset[0]+"px",moving_window.style.top=t.clientY-move_offset[1]+"px")}))}));var settings={};function load_settings(){let t=localStorage.getItem("settings"),e=new URL(window.location.href),i=e.searchParams.get("url"),s=e.searchParams.get("w"),n=e.searchParams.get("h");i&&($("#embed-url").value=i,embed_player()),s&&($("#canvas-width").value=s),n&&($("#canvas-height").value=n),t&&(t=JSON.parse(t),$("#settings-window").style.left=t.settings_x_pos,$("#settings-window").style.top=t.settings_y_pos,$("#element-list-window").style.left=t.element_list_x_pos,$("#element-list-window").style.top=t.element_list_y_pos,s||($("#canvas-width").value=t.canvas_width),n||($("#canvas-height").value=t.canvas_height),i||($("#embed-url").value=t.stream_url,embed_player()))}function save_settings(){settings.settings_x_pos=$("#settings-window").style.left,settings.settings_y_pos=$("#settings-window").style.top,settings.element_list_x_pos=$("#element-list-window").style.left,settings.element_list_y_pos=$("#element-list-window").style.top,settings.canvas_width=$("#canvas-width").value,settings.canvas_height=$("#canvas-height").value,settings.stream_url=$("#embed-url").value,localStorage.setItem("settings",JSON.stringify(settings))}class element{constructor(t,e,i){this.data={id:void 0,transform:{x:0,y:0,width:0,height:0,rotation_x:0,rotation_y:0,rotation_z:0,flip_x:!1,flip_y:!1,scale_x:1,scale_y:1,z_index:0,opacity:1,visible:!1,h_pivot:"center",v_pivot:"center"}},this.parent=t;for(let t in i)"transform"!==t&&(this.data[t]=i[t]);for(let t in i.transform)this.data.transform[t]=i.transform[t];this.data.type=e,null==i.id&&(this.data.id=Math.random().toString(36).substring(7)),this.html=null}shuffle_id(){this.data.id=Math.random().toString(36).substring(7)}delete(){null!=this.html&&(this.html.remove(),this.html=null)}id(){return this.data.id}type(){return this.data.type}clone(){let t=JSON.parse(JSON.stringify(this.data)),e=create_element(this.parent,t.type,t);return e.shuffle_id(),e}tf(){return this.data.transform}reset_transform(){this.tf().rotation_x=0,this.tf().rotation_y=0,this.tf().rotation_z=0,this.tf().flip_x=!1,this.tf().flip_y=!1,this.tf().scale_x=1,this.tf().scale_y=1,this.tf().h_pivot="center",this.tf().v_pivot="center",this.update()}update(){null!=this.html&&(this.html.style.transform=this.build_transform(),this.tf().width>0&&this.tf().height>0&&(this.html.style.width=this.tf().width+"px",this.html.style.height=this.tf().height+"px"),this.html.style.zIndex=this.tf().z_index,this.html.style.opacity=this.tf().opacity,this.html.style.transformOrigin=`${this.tf().h_pivot} ${this.tf().v_pivot}`,this.tf().visible?this.html.classList.remove("hidden"):this.html.classList.add("hidden")),this.tf().width<0&&(this.tf().width=Math.abs(this.tf().width),this.tf().x-=this.tf().width),this.tf().height<0&&(this.tf().height=Math.abs(this.tf().height),this.tf().y-=this.tf().height)}set_layer(t){this.tf().z_index=t,this.update()}flip_x(){this.tf().flip_x=!this.tf().flip_x,this.update()}flip_y(){this.tf().flip_y=!this.tf().flip_y,this.update()}build_transform(){let t="";return t+=`translate(${this.tf().x}px, ${this.tf().y}px)`,t+=` scale(${this.tf().scale_x}, ${this.tf().scale_y})`,t+=` rotateX(${this.tf().rotation_x}deg) rotateY(${this.tf().rotation_y}deg) rotateZ(${this.tf().rotation_z}deg) `,this.tf().flip_x&&(t+="scaleX(-1) "),this.tf().flip_y&&(t+="scaleY(-1) "),t}is_resizable(){return!1}}class element_handler{constructor(t,e){this.edt=t,this.type=e}update_selected_element(){}}var element_types=null;function create_element(t,e,i){return null==element_types[e]?null:new element_types[e](t,i)}$(document).ready((()=>{element_types={image:image_element,text:text_element}}));class image_element extends element{constructor(t,e){super(t,"image",e),this.html=$(`<img draggable="false" class="iros-element" id="${e.id}" src="${this.data.url}"></img>`),this.html.onload=()=>{this.tf().width=Math.max(this.html.width,100),this.tf().height=Math.max(this.html.height,100),this.parent.is_editor()&&this.parent.update_selected_element()}}set_url(t){this.html.src=t,this.data.url=t}update(){super.update(),-1==this.html.src.indexOf(this.data.url)&&(this.html.src=this.data.url)}is_resizable(){return!0}}class image_element_handler extends element_handler{constructor(t){super(t,"image"),this.url_settings=$("#url-settings"),this.url=$("#url-input"),this.selected_element=null,this.url.on("input",(()=>this.update_selected_element()))}update_selected_element(){this.selected_element&&(this.selected_element.set_url(this.url.value),send_command_update_element(this.edt,this.selected_element))}show_settings(t){this.url_settings.style.display="grid",this.url.value=t.data.url,this.selected_element=t}hide_settings(){this.url_settings.style.display="none",this.selected_element=null}}function add_image_element(){let t={url:`${document.location.origin}${config.ROOT}img/empty.png`,transform:{x:0,y:0,width:100,height:100},name:`Image ${edt.get_next_element_id()}`};edt.add_element(create_element(edt,"image",t))}class text_element extends element{constructor(t,e){super(t,"text",e),this.html=$(`<div class="iros-element" id="${this.data.id}">${this.get_formatted_text()}</div>`)}update(){this.tf().visible?this.html.classList.remove("hidden"):this.html.classList.add("hidden"),this.html.style.zIndex=this.tf().z_index,this.html.style.opacity=this.tf().opacity,this.html.style.transform=this.build_transform(),this.html.style.fontFamily=this.data.font,this.html.style.fontSize=this.data.size+"px",this.html.style.color=this.data.color,this.html.innerHTML=this.get_formatted_text(),this.data.transform.width=this.html.clientWidth,this.data.transform.height=this.html.clientHeight,this.html.style.transformOrigin=`${this.tf().h_pivot} ${this.tf().v_pivot}`}get_formatted_text(){let t=this.data.text.replace(/\n/g,"<br>");return t=t.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),t=t.replace(/\*(.*?)\*/g,"<i>$1</i>"),t=t.replace(/~~(.*?)~~/g,"<s>$1</s>"),t=t.replace(/__(.*?)__/g,"<u>$1</u>"),t}}class text_element_handler extends element_handler{constructor(t){super(t,"text"),this.color_settings=$("#color-settings"),this.text_settings=$("#text-settings"),this.color=$("#color"),this.text=$("#text"),this.font=$("#font"),this.size=$("#font-size"),this.selected_element=null,this.color.on("input",(()=>this.update_selected_element())),this.text.on("input",(()=>this.update_selected_element())),this.font.on("input",(()=>this.update_selected_element())),this.size.on("input",(()=>this.update_selected_element_and_ui()))}update_selected_element_and_ui(){this.update_selected_element(),this.edt.update_selected_element()}update_selected_element(){this.selected_element&&(this.selected_element.data.color=this.color.value,this.selected_element.data.text=this.text.value,this.selected_element.data.font=this.font.value,this.selected_element.data.size=Number(this.size.value),send_command_update_element(this.edt,this.selected_element),this.selected_element.update())}show_settings(t){this.color_settings.style.display="grid",this.text_settings.style.display="grid",this.color.value=t.data.color,this.text.value=t.data.text,this.font.value=t.data.font,this.size.value=t.data.size,this.selected_element=t}hide_settings(){this.color_settings.style.display="none",this.text_settings.style.display="none",this.selected_element=null}}function add_text_element(){let t={text:"Hello World!",font:"serif",size:32,color:"#ff0000",name:`Text ${edt.get_next_element_id()}`};edt.add_element(create_element(edt,"text",t))}var player=null;function embed_player(){let t=$("#embed-url").value;if(t.includes("youtube"));else if(t.includes("twitch")){let i=t.split("/");var e={width:"100%",height:"100%",channel:i[i.length-1],parent:[document.location.hostname]};(player=new Twitch.Player("player",e)).setVolume(.2)}save_settings()}function generate_session(){let t=$("#stream-link").value,e=$("#size").value,i="",s="";if(""===t)return void alert("Please provide a url to your stream first!");if(-1!==e.indexOf("x")){let t=e.split("x");i=Number(t[0]),s=Number(t[1]),(isNaN(i)||i<1280)&&(i=1280),(isNaN(s)||s<720)&&(s=720)}var n=uuidv4();let h="",o="";""===i||""===s?(h=`${document.location.origin}/editor?session=${n}&stream=${t}`,o=`${document.location.origin}/viewer?session=${n}&stream=${t}`):(h=`${document.location.origin}/viewer?session=${n}&stream=${t}`,o=`${document.location.origin}/viewer?session=${n}&stream=${t}`),$("#editor-link").value=h,$("#overlay-link").value=o,$("#link-container").classList.remove("hidden"),$("#link-container").classList.add("visible")}function copy_link(t){var e=$("#"+t).value;navigator.clipboard.writeText(e)}const EDIT_MODE={NONE:-1,MOVE:0,SCALE:1,ROTATE:2},MODE_AXIS={NONE:-1,X:0,Y:1,Z:2,XY:3};function hex_to_rgba(t){let e=parseInt(t.substring(1),16);return`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, 1)`}function $(t){var e=null;if("object"==typeof t)e=t;else if("<"===t[0]){var i=document.createElement("div");i.innerHTML=t,e=i.firstChild}else{let i=document.querySelector(t);e=void 0===i.length?i:void 0!==i[0]?i[0]:i}return e&&(e.on=(t,i)=>e.addEventListener(t,(t=>i(t)))),e===document&&(e.ready=t=>document.addEventListener("DOMContentLoaded",(()=>t()))),e}function blob_to_base64(t){return new Promise((e=>{let i=new FileReader;i.onloadend=()=>e(i.result),i.readAsDataURL(t)}))}function blob_to_text(t){return new Promise((e=>{let i=new FileReader;i.onloadend=()=>e(i.result),i.readAsText(t)}))}function read_data_from_clipboard(){return new Promise((t=>t(navigator.clipboard.read()))).then((t=>{for(let e of t)for(let t of e.types)switch(t){case"image/png":case"image/jpeg":case"image/gif":case"text/plain":return e.getType(t)}})).then((t=>"text/plain"===t.type?blob_to_text(t):blob_to_base64(t)))}function normalize(t,e){let i=Math.sqrt(t*t+e*e);return[t/i,e/i]}function vector_to_angle(t,e){[t,e]=normalize(t,e);let i=Math.acos(e);return i=t>0?Math.PI+i:Math.PI-i,180*i/Math.PI}function lock_mouse(t){t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock()}function unlock_mouse(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock()}function clamp(t,e,i){return Math.min(Math.max(t,e),i)}function uuidv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}